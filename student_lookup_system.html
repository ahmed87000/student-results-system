<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="handheldFriendly" content="true">
    <title>نظام نتائج الطلاب الجامعي</title>
    <!-- Bootstrap RTL CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.rtl.min.css" rel="stylesheet">
    <!-- SheetJS Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        /* تحسينات للشاشات الصغيرة */
        @media (max-width: 768px) {
            .welcome-title {
                font-size: 2.5rem !important;
            }
            .welcome-subtitle {
                font-size: 1.5rem !important;
            }
            .access-btn {
                font-size: 1.2rem !important;
                padding: 12px 25px !important;
                min-width: auto !important;
                margin: 10px 0 !important;
            }
            .feature-card {
                padding: 20px !important;
                margin: 10px 0 !important;
            }
            .feature-icon {
                font-size: 3rem !important;
                margin-bottom: 15px !important;
            }
            .feature-title {
                font-size: 1.4rem !important;
            }
            .feature-description {
                font-size: 1rem !important;
            }
            .nav-tabs .nav-link {
                padding: 12px 15px !important;
                font-size: 16px !important;
            }
            .form-control, .btn {
                padding: 12px 15px !important;
                font-size: 16px !important;
            }
            .data-item, .admin-data-item {
                padding: 15px !important;
            }
            .data-label, .admin-data-label {
                font-size: 18px !important;
            }
            .data-value {
                font-size: 20px !important;
            }
            .admin-login-form {
                padding: 25px !important;
            }
            .modal-dialog {
                margin: 10px !important;
            }
            .welcome-section {
                padding: 20px 15px !important;
            }
            .welcome-section h1 {
                font-size: 30px !important;
            }
            .welcome-section h2 {
                font-size: 20px !important;
            }
            .search-section, .admin-section {
                padding: 20px !important;
            }
            .main-container {
                margin: 15px 0 !important;
            }
            .result-card {
                padding: 20px !important;
            }
            .system-logo {
                margin-bottom: 15px !important;
            }
            .footer h6 {
                font-size: 18px !important;
            }
            .stats-chart {
                height: 250px !important;
            }
        }

        @media (max-width: 480px) {
            .welcome-title {
                font-size: 2rem !important;
            }
            .welcome-subtitle {
                font-size: 1.2rem !important;
            }
            .stat-number {
                font-size: 2.5rem !important;
            }
            .stat-label {
                font-size: 1.1rem !important;
            }
            .nav-back {
                padding: 8px 15px !important;
                font-size: 16px !important;
            }
        }

        /* تحسينات للوحة اللمس */
        button, input, .nav-link, .upload-box {
            -webkit-tap-highlight-color: transparent;
        }
        .btn:active {
            transform: scale(0.98) !important;
        }
        .nav-link:active {
            transform: perspective(500px) rotateX(10deg) !important;
        }

        /* تأثيرات اهتزاز جديدة */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .shake {
            animation: shake 0.5s;
        }

        /* التعديلات الجديدة لقسم المدير */
        .admin-login-form {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 35px;
            border: 3px solid #8e44ad;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }
        
        .admin-login-form .form-label {
            font-weight: bold;
            color: #8e44ad;
            font-size: 20px;
            margin-bottom: 15px;
        }
        
        .admin-login-form .form-control {
            background: #f8f9fa;
            border: 2px solid #8e44ad;
            border-radius: 15px;
            padding: 15px 20px;
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 25px;
        }
        
        .admin-login-form .form-control:focus {
            box-shadow: 0 0 0 3px rgba(142, 68, 173, 0.3);
            border-color: #9b59b6;
        }
        
        .admin-login-form .input-group-text {
            background: #8e44ad;
            color: white;
            border: 2px solid #8e44ad;
            border-radius: 15px 0 0 15px;
        }
        
        /* تنسيقات الطباعة الجديدة */
        @media print {
            body * {
                visibility: hidden;
            }
            
            .print-section, .print-section * {
                visibility: visible;
            }
            
            .print-section {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 20px;
            }
            
            .no-print {
                display: none !important;
            }
            
            .print-header {
                text-align: center;
                margin-bottom: 25px;
                padding-bottom: 20px;
                border-bottom: 3px solid #8e44ad;
            }
            
            .print-title {
                color: #8e44ad;
                font-weight: bold;
                font-size: 28px;
                margin-bottom: 10px;
            }
            
            .print-subtitle {
                color: #2c3e50;
                font-size: 22px;
                font-weight: 600;
                margin-bottom: 30px;
            }
            
            .print-table {
                width: 100%;
                border-collapse: collapse;
                margin: 20px 0;
            }
            
            .print-table th {
                background-color: #8e44ad;
                color: white;
                padding: 15px;
                text-align: right;
                border: 1px solid #7d3c98;
                font-weight: bold;
                font-size: 18px;
            }
            
            .print-table td {
                padding: 12px;
                text-align: right;
                border: 1px solid #ddd;
                font-size: 16px;
            }
            
            .print-table tr:nth-child(even) {
                background-color: #f9f9f9;
            }
            
            .print-footer {
                text-align: center;
                margin-top: 40px;
                padding-top: 20px;
                border-top: 1px solid #eee;
                color: #777;
                font-size: 16px;
            }
            
            .signature-section {
                margin-top: 50px;
                text-align: left;
            }
            
            .signature-line {
                width: 350px;
                border-top: 2px solid #333;
                margin-top: 80px;
            }
            
            .signature-label {
                margin-top: 10px;
                font-size: 18px;
            }
        }
        
        /* باقي الأنماط الأصلية */
        :root {
            --primary-blue: #3498db;
            --secondary-blue: #2980b9;
            --accent-green: #2ecc71;
            --accent-orange: #e67e22;
            --accent-purple: #9b59b6;
            --light-bg: #f8f9fa;
            --dark-text: #2c3e50;
            --admin-color: #9b59b6;
            --student-color: #3498db;
            --university-gold: #f1c40f;
        }
        
        * {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        body {
            background: linear-gradient(135deg, #0816dd 0%, #bbdefb 25%, #e9edf0 75%, #f5ef9a 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: bold;
            overflow-x: hidden;
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            font-family: 'Cairo', sans-serif;
            font-weight: bold;
            overflow: hidden;
            margin-top: 30px;
            margin-bottom: 30px;
            transform: translateY(0);
            animation: floatContainer 6s ease-in-out infinite;
        }
        
        @keyframes floatContainer {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
            100% { transform: translateY(0px); }
        }
        
        .welcome-section {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            color: white;
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        .welcome-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><path fill="rgba(255,255,255,0.1)" d="M40,-70.6C49.5,-61.4,52.7,-43.9,59.1,-28.5C65.5,-13.1,75.1,0.1,76.1,14.1C77.1,28.1,69.5,42.9,59.1,55.5C48.7,68.1,35.5,78.5,20.3,83.9C5.1,89.3,-12,89.7,-26.9,84.4C-41.8,79.1,-54.4,68,-64.5,55.1C-74.6,42.2,-82.1,27.5,-84.7,12C-87.3,-3.5,-85.1,-19.8,-78.1,-33.5C-71.1,-47.2,-59.4,-58.4,-46.1,-66.1C-32.7,-73.8,-17.7,-78.1,-0.8,-77C16.1,-75.9,32.2,-69.5,40,-70.6Z" transform="translate(100 100)"/></svg>');
            background-size: cover;
            opacity: 0.3;
            animation: moveBackground 20s linear infinite;
        }
        
        @keyframes moveBackground {
            0% { transform: translate(0, 0); }
            25% { transform: translate(-5%, 5%); }
            50% { transform: translate(-10%, 0); }
            75% { transform: translate(-5%, -5%); }
            100% { transform: translate(0, 0); }
        }
        
        .nav-tabs {
            border-bottom: 2px solid var(--primary-blue);
            margin-bottom: 30px;
        }
        
        .nav-tabs .nav-link {
            font-size: 18px;
            font-weight: bold;
            color: var(--dark-text);
            border: none;
            border-radius: 15px 15px 0 0;
            padding: 18px 30px;
            transition: all 0.4s;
            background: rgba(52, 152, 219, 0.1);
            margin: 0 5px;
            transform: perspective(500px) rotateX(0deg);
        }
        
        .nav-tabs .nav-link.active {
            background: var(--primary-blue);
            color: white;
            border: none;
            transform: perspective(500px) rotateX(20deg);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        .nav-tabs .nav-link:hover:not(.active) {
            background: rgba(52, 152, 219, 0.2);
            transform: translateY(-5px);
        }
        
        .tab-content {
            padding: 25px;
        }
        
        .search-section {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            color: white;
            border-radius: 20px;
            margin-bottom: 30px;
            font-weight: bold;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }
        
        .admin-section {
            background: linear-gradient(135deg, var(--accent-purple), #8e44ad);
            color: white;
            border-radius: 20px;
            margin-bottom: 30px;
            font-weight: bold;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }
        
        .input-group-text {
            background: rgba(255, 255, 255, 0.25);
            border: none;
            color: white;
            font-size: 18px;
        }
        
        .form-control {
            border: none;
            border-radius: 15px;
            padding: 15px 20px;
            font-size: 18px;
            background: rgba(255, 255, 255, 0.25);
            color: white;
        }
        
        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .form-control:focus {
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.35);
            transform: scale(1.02);
        }
        
        .btn-student {
            background: linear-gradient(135deg, var(--accent-green), #27ae60);
            border: none;
            border-radius: 15px;
            padding: 15px 35px;
            font-weight: bold;
            color: white;
            font-size: 18px;
            box-shadow: 0 8px 20px rgba(46, 204, 113, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .btn-student::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }
        
        .btn-student:hover::before {
            left: 100%;
        }
        
        .btn-admin {
            background: linear-gradient(135deg, var(--accent-purple), #8e44ad);
            border: none;
            border-radius: 15px;
            padding: 15px 35px;
            font-weight: bold;
            color: white;
            font-size: 18px;
            box-shadow: 0 8px 20px rgba(155, 89, 182, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .btn-admin::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }
        
        .btn-admin:hover::before {
            left: 100%;
        }
        
        .result-card {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            color: white;
            border-radius: 20px;
            margin-bottom: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
            padding: 30px;
            opacity: 0;
            transform: translateY(30px);
            animation: slideUpFadeIn 0.8s ease forwards;
        }
        
        @keyframes slideUpFadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .admin-panel {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .data-item {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            margin-bottom: 15px;
            padding: 20px;
            border-left: 5px solid var(--university-gold);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transform: perspective(1000px) rotateY(0deg);
        }
        
        .data-item:hover {
            transform: perspective(1000px) rotateY(5deg);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .admin-data-item {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            margin-bottom: 15px;
            padding: 20px;
            border-left: 5px solid var(--accent-purple);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .data-label {
            font-weight: bold;
            color: var(--secondary-blue);
            margin-bottom: 8px;
            font-size: 20px;
        }
        
        .admin-data-label {
            font-weight: bold;
            color: var(--accent-purple);
            margin-bottom: 8px;
            font-size: 20px;
        }
        
        .data-value {
            font-size: 22px;
            color: var(--dark-text);
            font-weight: 600;
        }
        
        .loading {
            display: none;
        }
        
        .spinner-border {
            color: var(--primary-blue);
            width: 3rem;
            height: 3rem;
        }
        
        .alert {
            border-radius: 15px;
            border: none;
            font-size: 18px;
            padding: 20px;
        }
        
        .file-status {
            background: rgba(46, 204, 113, 0.15);
            border: 1px solid var(--accent-green);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .file-status.error {
            background: rgba(231, 76, 60, 0.15);
            border-color: var(--accent-orange);
        }
        
        .file-status.loading {
            background: rgba(52, 152, 219, 0.15);
            border-color: var(--primary-blue);
        }
        
        .login-form {
            max-width: 550px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.9);
            padding: 35px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }
        
        .upload-box {
            border: 3px dashed rgba(255, 255, 255, 0.5);
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            background: rgba(255, 255, 255, 0.15);
            cursor: pointer;
            transition: all 0.4s;
            position: relative;
            overflow: hidden;
        }
        
        .upload-box:hover {
            border-color: var(--university-gold);
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-5px);
        }
        
        .upload-box i {
            font-size: 60px;
            color: white;
            margin-bottom: 20px;
            text-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        
        .admin-info {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 20px;
            margin-top: 25px;
            backdrop-filter: blur(5px);
        }
        
        .footer {
            background: linear-gradient(135deg, var(--dark-text), #1a242f);
            color: white;
            text-align: center;
            padding: 25px 0;
            margin-top: 40px;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.15);
            border-top-left-radius: 30px;
            border-top-right-radius: 30px;
        }
        
        .footer h6 {
            margin: 0;
            font-weight: 600;
            color: #ecf0f1;
            font-size: 20px;
        }
        
        .footer p {
            margin: 10px 0 0 0;
            font-size: 16px;
            color: #bdc3c7;
        }
        
        .footer .heart {
            color: #e74c3c;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .admin-indicator {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            padding: 10px 20px;
            font-size: 16px;
            backdrop-filter: blur(5px);
        }
        
        .file-list {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 20px;
            margin-top: 25px;
            color: var(--dark-text);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }
        
        .file-list h5 {
            color: var(--accent-purple);
            border-bottom: 3px solid var(--accent-purple);
            padding-bottom: 15px;
            margin-bottom: 20px;
            font-size: 22px;
        }
        
        .file-list ul {
            list-style-type: none;
            padding: 0;
        }
        
        .file-list li {
            padding: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 10px;
            margin-bottom: 10px;
            background: rgba(52, 152, 219, 0.05);
        }
        
        .file-list li:hover {
            background: rgba(52, 152, 219, 0.1);
            transform: translateX(10px);
        }
        
        .file-list li:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .system-logo {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            perspective: 1000px;
        }
        
        .system-logo img {
            max-width: 200px;
            height: auto;
            margin: 0 20px;
            filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.3));
            transform: rotateY(0deg);
            transition: transform 0.6s;
        }
        
        .system-logo img:hover {
            transform: rotateY(20deg);
        }
        
        .welcome-page {
            text-align: center;
            padding: 50px 20px;
            animation: fadeIn 1.2s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .welcome-title {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 30px;
            color: var(--dark-text);
            text-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            display: inline-block;
        }
        
        .welcome-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-blue), var(--accent-green));
            border-radius: 10px;
        }
        
        .welcome-subtitle {
            font-size: 2rem;
            color: var(--secondary-blue);
            margin-bottom: 50px;
            font-weight: 700;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .features {
            margin: 60px 0;
            perspective: 1000px;
        }
        
        .feature-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            transition: all 0.5s;
            height: 100%;
            border: 1px solid rgba(52, 152, 219, 0.1);
            transform: translateZ(0);
        }
        
        .feature-card:hover {
            transform: translateY(-15px) translateZ(20px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        
        .feature-icon {
            font-size: 4rem;
            margin-bottom: 25px;
            color: var(--primary-blue);
            text-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .feature-title {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: var(--dark-text);
        }
        
        .feature-description {
            color: #555;
            font-size: 1.2rem;
            line-height: 1.7;
        }
        
        .access-buttons {
            margin: 50px 0;
        }
        
        .access-btn {
            font-size: 1.6rem;
            padding: 18px 45px;
            margin: 20px;
            border-radius: 50px;
            transition: all 0.4s;
            min-width: 280px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
            transform: translateZ(0);
        }
        
        .access-btn:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }
        
        .access-btn i {
            margin-left: 12px;
        }
        
        .stats-section {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            color: white;
            border-radius: 25px;
            padding: 40px 30px;
            margin: 60px 0;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }
        
        .stat-number {
            font-size: 3.5rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--university-gold);
            text-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        
        .stat-label {
            font-size: 1.4rem;
            opacity: 0.9;
        }
        
        .nav-back {
            margin-bottom: 25px;
            cursor: pointer;
            color: var(--primary-blue);
            font-weight: bold;
            display: inline-block;
            font-size: 18px;
            padding: 10px 20px;
            border-radius: 50px;
            background: rgba(52, 152, 219, 0.1);
        }
        
        .nav-back:hover {
            transform: translateX(-10px);
            background: rgba(52, 152, 219, 0.2);
            color: var(--secondary-blue);
        }
        
        .settings-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 25px;
            margin-top: 25px;
            color: var(--dark-text);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
        }
        
        .settings-card h5 {
            color: var(--accent-purple);
            border-bottom: 3px solid var(--accent-purple);
            padding-bottom: 15px;
            margin-bottom: 25px;
            font-size: 22px;
        }
        
        .btn-delete {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 8px 15px;
            transition: all 0.4s;
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }
        
        .btn-delete:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);
        }
        
        .password-strength {
            height: 8px;
            border-radius: 10px;
            margin-top: 8px;
            background: #e9ecef;
            overflow: hidden;
        }
        
        .password-strength-bar {
            height: 100%;
            width: 0%;
            transition: width 0.5s;
        }
        
        .strength-weak {
            background-color: #e74c3c;
            width: 30%;
        }
        
        .strength-medium {
            background-color: #f39c12;
            width: 60%;
        }
        
        .strength-strong {
            background-color: #2ecc71;
            width: 100%;
        }
        
        .modal-content {
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            border: none;
        }
        
        .modal-header {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            color: white;
            padding: 25px;
        }
        
        .progress-container {
            height: 12px;
            background: #e9ecef;
            border-radius: 10px;
            margin-top: 15px;
            overflow: hidden;
            display: none;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-green), var(--primary-blue));
            width: 0%;
            transition: width 0.5s;
        }
        
        .upload-progress {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 16px;
            color: white;
        }
        
        .db-status {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 15px;
            margin-top: 20px;
            font-size: 16px;
            text-align: center;
            backdrop-filter: blur(5px);
        }
        
        .student-icon {
            width: 180px;
            height: 180px;
            margin: 0 auto 30px;
            background: url('https://cdn-icons-png.flaticon.com/512/3135/3135715.png') center/contain no-repeat;
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.2));
            animation: float 4s ease-in-out infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0px); }
        }
        
        .university-icon {
            width: 150px;
            height: 150px;
            margin: 0 auto 30px;
            background: url('https://static.vecteezy.com/system/resources/previews/014/441/276/original/university-building-icon-illustration-free-vector.jpg') center/contain no-repeat;
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.2));
        }
        
        .bounce-in {
            animation: bounceIn 0.8s both;
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }
        
        /* التعديلات الجديدة لعرض صورة الطالب */
        .student-image-container {
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            border: 4px solid white;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            position: relative;
            background: #f8f9fa;
        }
        
        .student-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .student-image-container:hover .student-image {
            transform: scale(1.05);
        }
        
        .no-image {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
            color: #6c757d;
            text-align: center;
            width: 100%;
            padding: 0 10px;
        }

        /* صورة التخرج العامة */
        .graduate-icon {
            background: url('https://cdn-icons-png.flaticon.com/512/3135/3135715.png') center/cover no-repeat;
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            border-radius: 50%;
            border: 4px solid white;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        /* إحصائيات حقيقية جديدة */
        .real-stats {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            min-width: 200px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            border-top: 5px solid var(--primary-blue);
        }
        
        .stat-box:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }
        
        .stat-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--primary-blue);
        }
        
        .stats-chart {
            height: 300px;
            margin: 30px 0;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .stat-trend {
            font-size: 0.9rem;
            margin-top: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .trend-up {
            color: #2ecc71;
        }
        
        .trend-down {
            color: #e74c3c;
        }
        
        .trend-icon {
            margin-right: 5px;
        }

        /* بيانات العينة */
        .data-sample {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            color: var(--dark-text);
        }
        
        /* زر استعادة كلمة المرور */
        .password-reset-btn {
            background: linear-gradient(135deg, #e67e22, #d35400);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 8px 15px;
            font-size: 14px;
            margin-top: 10px;
            transition: all 0.3s;
        }
        
        .password-reset-btn:hover {
            background: linear-gradient(135deg, #d35400, #a04000);
            transform: translateY(-3px);
        }
    </style>
</head>
<body>
    <!-- الصفحة الرئيسية الترحيبية -->
    <div id="welcomePage" class="welcome-page">
        <div class="container">
            <div class="student-icon bounce-in"></div>
            
            <h1 class="welcome-title">
                نظام نتائج الطلبة الجامعي
            </h1>
            
            <h3 class="welcome-subtitle">
                قسم تقنيات الأجهزة الطبية
            </h3>
            
            <div class="row justify-content-center features">
                <div class="col-md-4">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <h3 class="feature-title">استعلام فوري</h3>
                        <p class="feature-description">
                            استرجع نتائجك في ثوانٍ باستخدام الكود الخاص بك
                        </p>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3 class="feature-title">حماية متكاملة</h3>
                        <p class="feature-description">
                            نظام آمن يحافظ على خصوصية بياناتك ونتائجك
                        </p>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3 class="feature-title">إدارة ذكية</h3>
                        <p class="feature-description">
                            لوحة تحكم متطورة لإدارة النتائج والبيانات
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="access-buttons">
                <button class="btn btn-student access-btn" onclick="showSection('student')">
                    <i class="fas fa-user-graduate"></i>
                    الدخول كطالب
                </button>
                <button class="btn btn-admin access-btn" onclick="showSection('admin')">
                    <i class="fas fa-user-shield"></i>
                    الدخول كمدير
                </button>
            </div>
            
            <!-- إحصائيات واقعية -->
            <div class="real-stats">
                <div class="stat-box">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-number" id="totalStudentsStat">0</div>
                    <div class="stat-label">طالب مسجل</div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up trend-icon"></i> +12% هذا الشهر
                    </div>
                </div>
                
                <div class="stat-box">
                    <div class="stat-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <div class="stat-number" id="totalSearchesStat">0</div>
                    <div class="stat-label">بحث تم إجراؤه</div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up trend-icon"></i> +24% هذا الأسبوع
                    </div>
                </div>
                
                <div class="stat-box">
                    <div class="stat-icon">
                        <i class="fas fa-file-upload"></i>
                    </div>
                    <div class="stat-number" id="totalFilesStat">0</div>
                    <div class="stat-label">ملف تم رفعه</div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up trend-icon"></i> +3 هذا الشهر
                    </div>
                </div>
                
                <div class="stat-box">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-number" id="successSearchesStat">0</div>
                    <div class="stat-label">نتيجة تم استخراجها</div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up trend-icon"></i> +18% هذا الأسبوع
                    </div>
                </div>
            </div>
            
            <!-- رسم بياني للإحصائيات -->
            <div class="stats-chart">
                <canvas id="statsChart"></canvas>
            </div>
        </div>
    </div>
    
    <!-- نظام التبويبات -->
    <div id="systemContainer" class="container py-5" style="display:none">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="main-container p-4">
                    <!-- زر العودة للصفحة الرئيسية -->
                    <div class="nav-back" onclick="showWelcomePage()">
                        <i class="fas fa-arrow-right me-2"></i> العودة للصفحة الرئيسية
                    </div>
                    
                    <!-- ترحيب -->
                    <div class="welcome-section">
                        <div class="system-logo">
                            <div class="university-icon"></div>
                        </div>
                        
                        <h1>
                            <i class="fas fa-graduation-cap me-2"></i>
                            <h1 style="font-weight: bold; font-size: 45px;">نظام نتائج الطلبة الجامعي</h1> 
                            <h2 class="mb-0" style="font-weight: bold;">قسم تقنيات الأجهزة الطبية</h2>
                        </h1>
                    </div>
                    
                    <!-- أقسام النظام -->
                    <ul class="nav nav-tabs" id="systemTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="student-tab" data-bs-toggle="tab" data-bs-target="#student" type="button" role="tab">واجهة الطالب</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="admin-tab" data-bs-toggle="tab" data-bs-target="#admin" type="button" role="tab">واجهة المدير</button>
                        </li>
                    </ul>
                    
                    <div class="tab-content" id="systemTabsContent">
                        <!-- قسم الطالب -->
                        <div class="tab-pane fade show active" id="student" role="tabpanel">
                            <div class="search-section">
                                <h4 class="mb-4">
                                    <i class="fas fa-keyboard me-2"></i>
                                   <p style="display: inline; font-weight: bold;">عزيزي الطالب يرجى ادخال الكود الخاص بك</p>
                                </h4>
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="input-group mb-3">
                                            <span class="input-group-text">
                                                <i class="fas fa-id-card"></i>
                                            </span>
                                            <input type="text" class="form-control" id="studentCode" 
                                                   placeholder="أدخل كود الطالب هنا..." 
                                                   onkeypress="handleEnterPress(event)" autofocus>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-student w-100" onclick="searchStudent()">
                                            <i class="fas fa-search me-2"></i>
                                            بحث
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Loading -->
                            <div class="loading text-center py-4" id="loading">
                                <div class="spinner-border" role="status">
                                    <span class="visually-hidden">جاري البحث...</span>
                                </div>
                                <p class="mt-2">جاري البحث عن البيانات...</p>
                            </div>
                            
                            <!-- النتائج -->
                            <div id="results"></div>
                        </div>
                        
                        <!-- قسم المدير -->
                        <div class="tab-pane fade" id="admin" role="tabpanel">
                            <div class="admin-section">
                                <div id="adminLoginSection">
                                    <h4 class="mb-4 text-center">
                                        <i class="fas fa-lock me-2"></i>
                                        تسجيل الدخول لقسم المدير
                                    </h4>
                                    
                                    <div class="admin-login-form">
                                        <div class="mb-4">
                                            <label for="adminUsername" class="form-label">اسم المستخدم</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-user"></i></span>
                                                <input type="text" class="form-control" id="adminUsername" placeholder="أدخل اسم المستخدم" value="admin">
                                            </div>
                                        </div>
                                        
                                        <div class="mb-4">
                                            <label for="adminPassword" class="form-label">كلمة المرور</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-key"></i></span>
                                                <input type="password" class="form-control" id="adminPassword" placeholder="أدخل كلمة المرور">
                                            </div>
                                        </div>
                                        
                                        <div class="d-grid">
                                            <button class="btn btn-admin" onclick="adminLogin()">
                                                <i class="fas fa-sign-in-alt me-2"></i>
                                                تسجيل الدخول
                                            </button>
                                        </div>
                                        
                                        <!-- زر استعادة كلمة المرور -->
                                        <div class="text-center mt-3">
                                            <button class="btn password-reset-btn" onclick="resetAdminPassword()">
                                                <i class="fas fa-redo-alt me-2"></i>
                                                استعادة كلمة المرور الافتراضية
                                            </button>
                                        </div>
                                        
                                        <div class="alert alert-danger mt-3" id="loginError" style="display:none">
                                            <i class="fas fa-exclamation-circle me-2"></i>
                                            اسم المستخدم أو كلمة المرور غير صحيحة
                                        </div>
                                        
                                        <div class="alert alert-info mt-3" id="passwordResetInfo" style="display:none">
                                            <i class="fas fa-info-circle me-2"></i>
                                            تم استعادة كلمة المرور الافتراضية: <strong>admin123</strong>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="adminPanel" style="display:none">
                                    <div class="admin-header">
                                        <h4>
                                            <i class="fas fa-user-cog me-2"></i>
                                            لوحة تحكم المدير
                                        </h4>
                                        <div class="admin-indicator">
                                            <i class="fas fa-user-shield me-2"></i>
                                            <span id="adminName">المدير</span>
                                            <button class="btn btn-sm btn-light ms-3" onclick="adminLogout()">
                                                <i class="fas fa-sign-out-alt me-1"></i>
                                                تسجيل الخروج
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="admin-panel">
                                        <h5 class="mb-4">
                                            <i class="fas fa-file-excel me-2"></i>
                                            رفع ملف النتائج الجديد
                                        </h5>
                                        
                                        <div class="upload-box" id="uploadBox" onclick="document.getElementById('fileInput').click()">
                                            <i class="fas fa-cloud-upload-alt"></i>
                                            <h5>انقر لرفع ملف Excel</h5>
                                            <p class="text-muted">(يجب أن يكون الملف بصيغة .xlsx أو .xls)</p>
                                            <input type="file" id="fileInput" accept=".xlsx,.xls" style="display:none" onchange="handleFileSelect(event)">
                                        </div>
                                        
                                        <div class="alert alert-info mt-3" id="uploadStatus">
                                            <i class="fas fa-info-circle me-2"></i>
                                            لم يتم رفع أي ملف بعد
                                        </div>
                                        
                                        <!-- بيانات العينة -->
                                        <div class="data-sample" id="dataSample" style="display:none">
                                            <h6><i class="fas fa-database me-2"></i>عينة من البيانات المحملة:</h6>
                                            <div id="sampleDataContent"></div>
                                        </div>
                                        
                                        <div class="admin-info">
                                            <h6><i class="fas fa-lightbulb me-2"></i>تعليمات:</h6>
                                            <ul>
                                                <li>يجب أن يحتوي ملف Excel على رأسيات الأعمدة في الصف الأول</li>
                                                <li>يجب أن يحتوي العمود الأول على أكواد الطلاب الفريدة</li>
                                                <li>بعد الرفع الناجح، ستصبح البيانات متاحة للطلاب فوراً</li>
                                            </ul>
                                        </div>
                                        
                                        <div class="file-list">
                                            <h5><i class="fas fa-history me-2"></i>آخر الملفات المرفوعة</h5>
                                            <ul id="uploadedFiles">
                                                <li>لا توجد ملفات مرفوعة</li>
                                            </ul>
                                        </div>
                                        
                                        <!-- إعدادات المدير الجديدة -->
                                        <div class="settings-card">
                                            <h5><i class="fas fa-cog me-2"></i>إعدادات المدير</h5>
                                            
                                            <div class="mb-3">
                                                <label class="form-label">تغيير كلمة المرور</label>
                                                <button class="btn btn-admin w-100" data-bs-toggle="modal" data-bs-target="#passwordModal">
                                                    <i class="fas fa-key me-2"></i>
                                                    تغيير كلمة المرور
                                                </button>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label class="form-label">إدارة الملفات</label>
                                                <div class="alert alert-warning">
                                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                                    سيتم حذف جميع سجلات الملفات المرفوعة
                                                </div>
                                                <button class="btn btn-danger w-100" onclick="confirmDeleteAllFiles()">
                                                    <i class="fas fa-trash-alt me-2"></i>
                                                    مسح جميع الملفات القديمة
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <h6>
                <i class="fas fa-graduation-cap me-2"></i>
                تم التطوير بواسطة الأستاذ المهندس أحمد حميد عيال
            </h6>
            <p>
                صُمم بـ <span class="heart">♥</span> لخدمة الطلاب والتعليم
                © 2025 جميع الحقوق محفوظة
            </p>
        </div>
    </footer>

    <!-- Modal لتغيير كلمة المرور -->
    <div class="modal fade" id="passwordModal" tabindex="-1" aria-labelledby="passwordModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="passwordModalLabel">
                        <i class="fas fa-key me-2"></i>
                        تغيير كلمة المرور
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="passwordForm">
                        <div class="mb-3">
                            <label for="currentPassword" class="form-label">كلمة المرور الحالية</label>
                            <input type="password" class="form-control" id="currentPassword" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="newPassword" class="form-label">كلمة المرور الجديدة</label>
                            <input type="password" class="form-control" id="newPassword" required onkeyup="checkPasswordStrength()">
                            <div class="password-strength mt-2">
                                <div class="password-strength-bar" id="passwordStrengthBar"></div>
                            </div>
                            <small id="passwordHelp" class="form-text text-muted">
                                يجب أن تحتوي كلمة المرور على 8 أحرف على الأقل وتشمل أرقاماً ورموزاً
                            </small>
                        </div>
                        
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">تأكيد كلمة المرور الجديدة</label>
                            <input type="password" class="form-control" id="confirmPassword" required>
                        </div>
                        
                        <div class="alert alert-danger" id="passwordError" style="display:none">
                            <i class="fas fa-exclamation-circle me-2"></i>
                            <span id="passwordErrorMessage"></span>
                        </div>
                        
                        <div class="alert alert-success" id="passwordSuccess" style="display:none">
                            <i class="fas fa-check-circle me-2"></i>
                            تم تغيير كلمة المرور بنجاح!
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-admin" onclick="changePassword()">
                        <i class="fas fa-save me-2"></i>
                        حفظ التغييرات
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>

    <script>
        // بيانات النظام
        let excelData = null;
        let headers = [];
        let isAdminLoggedIn = false;
        const ADMIN_USERNAME = 'admin';
        const DEFAULT_PASSWORD = 'admin123';
        let adminPassword = localStorage.getItem('adminPassword') || DEFAULT_PASSWORD;
        let uploadedFiles = [];
        
        // تخزين بيانات الطالب الحالي للطباعة
        let currentStudentData = null;
        let currentStudentHeaders = [];
        let currentStudentRowNumber = 0;
        
        // بيانات الإحصائيات
        let systemStats = {
            totalStudents: 0,
            totalSearches: 0,
            totalFiles: 0,
            successSearches: 0
        };
        
        // وظائف التحكم بالصفحات
        function showWelcomePage() {
            document.getElementById('welcomePage').style.display = 'block';
            document.getElementById('systemContainer').style.display = 'none';
            updateStatisticsDisplay();
            renderStatsChart();
        }
        
        function showSection(section) {
            document.getElementById('welcomePage').style.display = 'none';
            document.getElementById('systemContainer').style.display = 'block';
            
            if (section === 'admin') {
                document.getElementById('admin-tab').click();
            } else {
                document.getElementById('student-tab').click();
            }
        }

        // تحميل البيانات عند تحميل الصفحة
        window.onload = function() {
            // تحميل الإحصائيات من localStorage
            loadStatistics();
            
            // التحقق من حالة تسجيل الدخول
            const savedLogin = localStorage.getItem('adminLoggedIn');
            if (savedLogin === 'true') {
                isAdminLoggedIn = true;
                document.getElementById('adminLoginSection').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('adminName').textContent = ADMIN_USERNAME;
            }
            
            // تحميل قائمة الملفات المرفوعة
            const savedFiles = localStorage.getItem('uploadedFiles');
            if (savedFiles) {
                uploadedFiles = JSON.parse(savedFiles);
                systemStats.totalFiles = uploadedFiles.length;
                updateFileList();
            }
            
            // تحميل بيانات النتائج المحفوظة
            loadSavedData();
            
            // تحسين تجربة اللمس للأجهزة المحمولة
            improveTouchExperience();
            
            // تحديث عرض الإحصائيات
            updateStatisticsDisplay();
            
            // رسم الرسم البياني
            renderStatsChart();
            
            // عرض كلمة المرور الافتراضية للمساعدة
            console.log('كلمة المرور الافتراضية:', DEFAULT_PASSWORD);
        };

        // تحسين تجربة اللمس
        function improveTouchExperience() {
            // منع التكبير عند النقر المزدوج
            document.addEventListener('dblclick', function(e) {
                e.preventDefault();
            }, { passive: false });
            
            // تحسين أداء الأزرار على الشاشات التي تعمل باللمس
            const buttons = document.querySelectorAll('button, .btn, .nav-link');
            buttons.forEach(button => {
                button.addEventListener('touchstart', function() {
                    this.classList.add('active');
                });
                button.addEventListener('touchend', function() {
                    this.classList.remove('active');
                });
            });
        }

        // تحميل البيانات المحفوظة من localStorage
        function loadSavedData() {
            try {
                const savedData = localStorage.getItem('excelData');
                const savedHeaders = localStorage.getItem('excelHeaders');
                
                if (savedData && savedHeaders) {
                    excelData = JSON.parse(savedData);
                    headers = JSON.parse(savedHeaders);
                    console.log('تم تحميل البيانات المحفوظة:', excelData.length, 'صف');
                    
                    // تحديث الإحصائيات
                    systemStats.totalStudents = Math.max(0, excelData.length - 1);
                    updateStatisticsDisplay();
                    
                    // عرض عينة من البيانات في لوحة المدير
                    if (isAdminLoggedIn) {
                        showDataSample();
                    }
                    
                    return true;
                }
            } catch (error) {
                console.error('خطأ في تحميل البيانات المحفوظة:', error);
            }
            return false;
        }

        // تسجيل دخول المدير
        function adminLogin() {
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            
            if (username === ADMIN_USERNAME && password === adminPassword) {
                isAdminLoggedIn = true;
                document.getElementById('adminLoginSection').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('loginError').style.display = 'none';
                document.getElementById('adminName').textContent = username;
                
                // عرض عينة من البيانات إذا كانت موجودة
                if (excelData && excelData.length > 0) {
                    showDataSample();
                }
                
                // حفظ حالة تسجيل الدخول
                localStorage.setItem('adminLoggedIn', 'true');
            } else {
                document.getElementById('loginError').style.display = 'block';
                // اهتزاز الحقول عند خطأ في التسجيل
                shakeLoginForm();
            }
        }
        
        // تأثير اهتزاز عند خطأ في تسجيل الدخول
        function shakeLoginForm() {
            const form = document.querySelector('.admin-login-form');
            form.classList.add('shake');
            setTimeout(() => {
                form.classList.remove('shake');
            }, 500);
        }

        // تسجيل خروج المدير
        function adminLogout() {
            isAdminLoggedIn = false;
            document.getElementById('adminLoginSection').style.display = 'block';
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('adminUsername').value = ADMIN_USERNAME;
            document.getElementById('adminPassword').value = '';
            
            // إزالة حالة تسجيل الدخول
            localStorage.removeItem('adminLoggedIn');
        }

        // استعادة كلمة المرور الافتراضية
        function resetAdminPassword() {
            adminPassword = DEFAULT_PASSWORD;
            localStorage.setItem('adminPassword', DEFAULT_PASSWORD);
            
            document.getElementById('passwordResetInfo').style.display = 'block';
            document.getElementById('loginError').style.display = 'none';
            
            // إخفاء الرسالة بعد 5 ثوان
            setTimeout(() => {
                document.getElementById('passwordResetInfo').style.display = 'none';
            }, 5000);
            
            console.log('تم استعادة كلمة المرور الافتراضية:', DEFAULT_PASSWORD);
        }

        // تغيير كلمة المرور
        function changePassword() {
            const currentPass = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirmPass = document.getElementById('confirmPassword').value;
            
            const errorDiv = document.getElementById('passwordError');
            const successDiv = document.getElementById('passwordSuccess');
            
            // إخفاء الرسائل السابقة
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';
            
            // التحقق من كلمة المرور الحالية
            if (currentPass !== adminPassword) {
                document.getElementById('passwordErrorMessage').textContent = 'كلمة المرور الحالية غير صحيحة';
                errorDiv.style.display = 'block';
                shakeModal();
                return;
            }
            
            // التحقق من مطابقة كلمتي المرور الجديدتين
            if (newPass !== confirmPass) {
                document.getElementById('passwordErrorMessage').textContent = 'كلمتا المرور الجديدتان غير متطابقتين';
                errorDiv.style.display = 'block';
                shakeModal();
                return;
            }
            
            // التحقق من قوة كلمة المرور
            if (newPass.length < 8) {
                document.getElementById('passwordErrorMessage').textContent = 'يجب أن تحتوي كلمة المرور على 8 أحرف على الأقل';
                errorDiv.style.display = 'block';
                shakeModal();
                return;
            }
            
            // إذا كانت جميع التحققات صحيحة، نقوم بتغيير كلمة المرور
            adminPassword = newPass;
            localStorage.setItem('adminPassword', newPass);
            
            // إظهار رسالة النجاح
            successDiv.style.display = 'block';
            
            // إغلاق النموذج بعد 2 ثانية
            setTimeout(() => {
                const modal = bootstrap.Modal.getInstance(document.getElementById('passwordModal'));
                if (modal) {
                    modal.hide();
                }
                
                // إعادة تعيين النموذج
                document.getElementById('passwordForm').reset();
                document.getElementById('passwordStrengthBar').className = 'password-strength-bar';
                document.getElementById('passwordStrengthBar').style.width = '0%';
            }, 2000);
        }
        
        // تأثير اهتزاز للمودال
        function shakeModal() {
            const modalContent = document.querySelector('.modal-content');
            modalContent.classList.add('shake');
            setTimeout(() => {
                modalContent.classList.remove('shake');
            }, 500);
        }

        // التحقق من قوة كلمة المرور
        function checkPasswordStrength() {
            const password = document.getElementById('newPassword').value;
            const strengthBar = document.getElementById('passwordStrengthBar');
            
            // إعادة تعيين شريط القوة
            strengthBar.className = 'password-strength-bar';
            strengthBar.style.width = '0%';
            
            if (password.length === 0) {
                return;
            }
            
            // حساب قوة كلمة المرور
            let strength = 0;
            
            // طول كلمة المرور
            if (password.length >= 8) strength += 30;
            if (password.length >= 12) strength += 20;
            
            // وجود أرقام
            if (/\d/.test(password)) strength += 20;
            
            // وجود رموز خاصة
            if (/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/.test(password)) strength += 20;
            
            // وجود أحرف كبيرة وصغيرة
            if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength += 10;
            
            // تحديث شريط القوة
            if (strength < 50) {
                strengthBar.classList.add('strength-weak');
                strengthBar.style.width = '30%';
            } else if (strength < 80) {
                strengthBar.classList.add('strength-medium');
                strengthBar.style.width = '60%';
            } else {
                strengthBar.classList.add('strength-strong');
                strengthBar.style.width = '100%';
            }
        }
        
        // تأكيد مسح جميع الملفات
        function confirmDeleteAllFiles() {
            if (uploadedFiles.length === 0) {
                showAdminAlert('warning', 'لا توجد ملفات لحذفها');
                return;
            }
            
            if (confirm('هل أنت متأكد أنك تريد حذف جميع سجلات الملفات المرفوعة؟ لا يمكن التراجع عن هذا الإجراء.')) {
                deleteAllFiles();
            }
        }
        
        // مسح جميع الملفات
        function deleteAllFiles() {
            uploadedFiles = [];
            systemStats.totalFiles = 0;
            localStorage.removeItem('uploadedFiles');
            updateFileList();
            saveStatistics();
            showAdminAlert('success', 'تم حذف جميع سجلات الملفات بنجاح');
            updateStatisticsDisplay();
        }
        
        // مسح ملف معين
        function deleteFile(index) {
            if (confirm('هل أنت متأكد أنك تريد حذف هذا السجل؟')) {
                uploadedFiles.splice(index, 1);
                systemStats.totalFiles = uploadedFiles.length;
                localStorage.setItem('uploadedFiles', JSON.stringify(uploadedFiles));
                updateFileList();
                saveStatistics();
                showAdminAlert('success', 'تم حذف السجل بنجاح');
                updateStatisticsDisplay();
            }
        }

        // معالجة اختيار الملف - الإصدار المحسن
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // التحقق من نوع الملف
            if (!file.name.match(/\.(xlsx|xls)$/)) {
                showAdminAlert('danger', 'يرجى اختيار ملف Excel بصيغة .xlsx أو .xls');
                return;
            }

            // تحديث حالة الرفع
            document.getElementById('uploadStatus').className = 'alert alert-info';
            document.getElementById('uploadStatus').innerHTML = `
                <i class="fas fa-sync fa-spin me-2"></i>
                جاري معالجة الملف: ${file.name}
            `;

            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // تحويل البيانات إلى JSON مع الحفاظ على التنسيق
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: '' });
                    
                    if (jsonData.length > 0 && jsonData[0].length > 0) {
                        // حفظ البيانات في المتغيرات العالمية
                        excelData = jsonData;
                        headers = jsonData[0];
                        
                        // حفظ البيانات في localStorage للتأكد من استمراريتها
                        localStorage.setItem('excelData', JSON.stringify(excelData));
                        localStorage.setItem('excelHeaders', JSON.stringify(headers));
                        localStorage.setItem('lastUploadTime', new Date().toISOString());
                        
                        // تحديث عدد الطلاب (بعد استبعاد رأس الجدول)
                        systemStats.totalStudents = Math.max(0, excelData.length - 1);
                        saveStatistics();
                        
                        // تحديث حالة الرفع
                        document.getElementById('uploadStatus').className = 'alert alert-success';
                        document.getElementById('uploadStatus').innerHTML = `
                            <i class="fas fa-check-circle me-2"></i>
                            تم رفع الملف بنجاح: ${file.name}
                            <br><small>عدد السجلات: ${systemStats.totalStudents}</small>
                            <br><small>عدد الأعمدة: ${headers.length}</small>
                        `;
                        
                        // عرض عينة من البيانات
                        showDataSample();
                        
                        // إضافة الملف إلى القائمة
                        uploadedFiles.unshift({
                            name: file.name,
                            date: new Date().toLocaleString('ar-EG'),
                            size: formatFileSize(file.size),
                            records: systemStats.totalStudents,
                            columns: headers.length
                        });
                        
                        systemStats.totalFiles = uploadedFiles.length;
                        
                        // حفظ القائمة
                        localStorage.setItem('uploadedFiles', JSON.stringify(uploadedFiles));
                        saveStatistics();
                        
                        // تحديث عرض القائمة
                        updateFileList();
                        updateStatisticsDisplay();
                        
                        // إظهار رسالة نجاح
                        showAdminAlert('success', `تم تحميل ${systemStats.totalStudents} سجل بنجاح وجاهز للبحث`);
                        
                    } else {
                        throw new Error('الملف لا يحتوي على بيانات صالحة');
                    }
                } catch (error) {
                    console.error('خطأ في معالجة الملف:', error);
                    document.getElementById('uploadStatus').className = 'alert alert-danger';
                    document.getElementById('uploadStatus').innerHTML = `
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        خطأ في معالجة الملف: ${error.message}
                    `;
                    showAdminAlert('danger', `خطأ في معالجة الملف: ${error.message}`);
                }
            };
            
            reader.onerror = function() {
                document.getElementById('uploadStatus').className = 'alert alert-danger';
                document.getElementById('uploadStatus').innerHTML = `
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    خطأ في قراءة الملف
                `;
                showAdminAlert('danger', 'خطأ في قراءة الملف');
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // عرض عينة من البيانات
        function showDataSample() {
            if (!excelData || excelData.length < 2) {
                document.getElementById('dataSample').style.display = 'none';
                return;
            }
            
            const sampleSize = Math.min(3, excelData.length - 1);
            let sampleHTML = '<div class="mt-2">';
            
            for (let i = 1; i <= sampleSize; i++) {
                const row = excelData[i];
                sampleHTML += `<div class="mb-2"><small><strong>السجل ${i}:</strong> ${row[0] || 'لا يوجد كود'} - ${row[1] || 'لا يوجد اسم'}</small></div>`;
            }
            
            sampleHTML += '</div>';
            
            document.getElementById('sampleDataContent').innerHTML = sampleHTML;
            document.getElementById('dataSample').style.display = 'block';
        }
        
        // تحديث قائمة الملفات المرفوعة
        function updateFileList() {
            const fileList = document.getElementById('uploadedFiles');
            fileList.innerHTML = '';
            
            if (uploadedFiles.length === 0) {
                fileList.innerHTML = '<li>لا توجد ملفات مرفوعة</li>';
                return;
            }
            
            uploadedFiles.slice(0, 5).forEach((file, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <div>
                        <i class="fas fa-file-excel text-success me-2"></i>
                        ${file.name}
                        <br>
                        <small class="text-muted">${file.date} (${file.size}) - ${file.records} سجل</small>
                    </div>
                    <div>
                        <button class="btn btn-delete" onclick="deleteFile(${index})">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                `;
                fileList.appendChild(li);
            });
        }
        
        // تنسيق حجم الملف
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' بايت';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' ك.ب';
            else return (bytes / 1048576).toFixed(1) + ' م.ب';
        }
        
        // إظهار تنبيه في قسم المدير
        function showAdminAlert(type, message) {
            const alertHTML = `
                <div class="alert alert-${type} alert-dismissible fade show mt-3" role="alert">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'exclamation-circle'} me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            // إضافة التنبيه في قسم المدير
            const adminPanel = document.querySelector('.admin-panel');
            adminPanel.insertAdjacentHTML('beforeend', alertHTML);
            
            // إزالة التنبيه تلقائياً بعد 5 ثوان
            setTimeout(() => {
                const alert = adminPanel.querySelector('.alert');
                if (alert) {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                }
            }, 5000);
        }

        function handleEnterPress(event) {
            if (event.key === 'Enter') {
                searchStudent();
            }
        }

        function searchStudent() {
            const studentCode = document.getElementById('studentCode').value.trim();
            
            if (!studentCode) {
                showAlert('warning', 'يرجى إدخال كود الطالب');
                return;
            }
            
            // محاولة تحميل البيانات المحفوظة إذا لم تكن محملة
            if (!excelData || excelData.length === 0) {
                const hasData = loadSavedData();
                if (!hasData) {
                    showAlert('danger', 'لا توجد بيانات متاحة. يرجى رفع ملف النتائج أولاً.');
                    return;
                }
            }

            // زيادة عدد مرات البحث
            systemStats.totalSearches++;
            saveStatistics();
            updateStatisticsDisplay();
            
            // إظهار Loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').innerHTML = '';

            // استخدام setTimeout لمحاكاة عملية البحث
            setTimeout(() => {
                const found = searchInData(studentCode);
                document.getElementById('loading').style.display = 'none';
                
                if (!found) {
                    showAlert('warning', `لم يتم العثور على كود الطالب: ${studentCode}`);
                    // اهتزاز حقل البحث
                    document.getElementById('studentCode').classList.add('shake');
                    setTimeout(() => {
                        document.getElementById('studentCode').classList.remove('shake');
                    }, 500);
                }
            }, 800);
        }

        function searchInData(searchCode) {
            let found = false;
            
            if (!excelData || excelData.length < 2) {
                console.error('لا توجد بيانات للبحث فيها');
                return false;
            }
            
            console.log('جاري البحث عن:', searchCode, 'في', excelData.length - 1, 'سجل');
            
            // البحث في جميع الصفوف (بدءاً من الصف الثاني - تجاهل العناوين)
            for (let i = 1; i < excelData.length; i++) {
                const row = excelData[i];
                
                if (!row || row.length === 0) continue;
                
                // البحث في جميع الأعمدة
                for (let j = 0; j < row.length; j++) {
                    const cellValue = row[j];
                    if (cellValue && cellValue.toString().trim() === searchCode) {
                        console.log('تم العثور على الطالب في الصف:', i + 1);
                        displayResult(row, i + 1, searchCode);
                        found = true;
                        
                        // زيادة عدد النتائج الناجحة
                        systemStats.successSearches++;
                        saveStatistics();
                        updateStatisticsDisplay();
                        break;
                    }
                }
                
                if (found) break;
            }
            
            if (!found) {
                console.log('لم يتم العثور على الكود:', searchCode);
            }
            
            return found;
        }

        function displayResult(rowData, rowNumber, studentCode) {
            const resultsDiv = document.getElementById('results');

            // تخزين بيانات الطالب الحالي للطباعة
            currentStudentData = rowData;
            currentStudentHeaders = headers;
            currentStudentRowNumber = rowNumber;
            
            let resultHTML = `
                <div class="result-card p-4">
                    <div class="text-center mb-4">
                        <!-- استخدام صورة تخرج عامة لجميع الطلاب -->
                        <div class="graduate-icon"></div>
                        <h4 class="mb-2" style="font-weight:bold;color:white;">
                            <i class="fas fa-user-graduate me-2"></i>
                            بيان نتائج الطالب
                        </h4>
                        <p class="mb-0" style="color: rgba(255,255,255,0.8);">قسم تقنيات الأجهزة الطبية - المعهد التقني في الكوت</p>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="data-item">
                                <div class="data-label">رقم السجل</div>
                                <div class="data-value">${rowNumber}</div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="data-item">
                                <div class="data-label">كود الطالب</div>
                                <div class="data-value">${studentCode}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
            `;
            
            for (let i = 0; i < rowData.length; i++) {
                const header = headers[i] || `العمود ${i + 1}`;
                const value = rowData[i] || 'غير محدد';
                
                // تخطي عرض كود الطالب مرة أخرى إذا كان في العمود الأول
                if (i === 0 && value === studentCode) continue;
                
                resultHTML += `
                    <div class="col-md-6 mb-4">
                        <div class="data-item">
                            <div class="data-label">${header}</div>
                            <div class="data-value">${value}</div>
                        </div>
                    </div>
                `;
            }
            
            resultHTML += `
                    </div>
                    
                    <div class="text-center mt-4">
                        <button class="btn btn-light" onclick="printResult()">
                            <i class="fas fa-print me-2"></i>
                            طباعة النتيجة
                        </button>
                        <button class="btn btn-outline-light ms-2" onclick="clearSearch()" style="background:white; color:black; font-weight:bold">
                            <i class="fas fa-search me-2"></i>
                            بحث جديد
                        </button>
                    </div>
                    
                    <div class="text-center mt-4" style="color: rgba(255,255,255,0.7);">
                        <small>تاريخ الإصدار: ${new Date().toLocaleDateString('ar-EG')}</small>
                    </div>
                </div>
            `;
            
            resultsDiv.innerHTML = resultHTML;
        }

        function clearSearch() {
            document.getElementById('studentCode').value = '';
            document.getElementById('results').innerHTML = '';
            document.getElementById('studentCode').focus();
        }

        function showAlert(type, message) {
            const alertHTML = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    <i class="fas fa-${type === 'warning' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            // إضافة التنبيه في أعلى النتائج
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = alertHTML;
            
            // إزالة التنبيه تلقائياً بعد 5 ثوان
            setTimeout(() => {
                const alert = resultsDiv.querySelector('.alert');
                if (alert) {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                }
            }, 5000);
        }

        function printResult() {
            if (!currentStudentData || !currentStudentHeaders) {
                alert('لا توجد بيانات للطالب متاحة للطباعة');
                return;
            }
            
            // إنشاء محتوى الطباعة
            let tableRows = '';
            for (let i = 0; i < currentStudentData.length; i++) {
                const header = currentStudentHeaders[i] || `العمود ${i + 1}`;
                const value = currentStudentData[i] || 'غير محدد';
                
                tableRows += `
                    <tr>
                        <td>${header}</td>
                        <td>${value}</td>
                    </tr>
                `;
            }
            
            const printContent = `
                <!DOCTYPE html>
                <html lang="ar" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <title>بيان نتائج الطالب</title>
                    <style>
                        body {
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            padding: 30px;
                            background: white;
                            color: #333;
                        }
                        .print-header {
                            text-align: center;
                            margin-bottom: 40px;
                            padding-bottom: 30px;
                            border-bottom: 3px solid #3498db;
                        }
                        .print-header img {
                            max-width: 180px;
                            margin-bottom: 20px;
                        }
                        .print-title {
                            color: #8e44ad;
                            font-weight: bold;
                            margin: 15px 0;
                            font-size: 28px;
                        }
                        .print-subtitle {
                            color: #555;
                            font-size: 22px;
                        }
                        .print-table {
                            width: 100%;
                            border-collapse: collapse;
                            margin: 20px 0;
                        }
                        .print-table th {
                            background-color: #8e44ad;
                            color: white;
                            padding: 15px;
                            text-align: right;
                            border: 1px solid #7d3c98;
                            font-weight: bold;
                            font-size: 18px;
                        }
                        .print-table td {
                            padding: 12px;
                            text-align: right;
                            border: 1px solid #ddd;
                            font-size: 16px;
                        }
                        .print-table tr:nth-child(even) {
                            background-color: #f9f9f9;
                        }
                        .print-footer {
                            text-align: center;
                            margin-top: 40px;
                            padding-top: 20px;
                            border-top: 1px solid #eee;
                            color: #777;
                            font-size: 16px;
                        }
                        .signature-section {
                            margin-top: 50px;
                            text-align: left;
                        }
                        .signature-line {
                            width: 350px;
                            border-top: 2px solid #333;
                            margin-top: 80px;
                        }
                        .signature-label {
                            margin-top: 10px;
                            font-size: 18px;
                        }
                        .university-logo {
                            width: 120px;
                            height: 120px;
                            margin: 0 auto 20px;
                            background: url('https://static.vecteezy.com/system/resources/previews/014/441/276/original/university-building-icon-illustration-free-vector.jpg') center/contain no-repeat;
                        }
                    </style>
                </head>
                <body>
                    <div class="print-section">
                        <div class="print-header">
                            <div class="university-logo"></div>
                            <h2 class="print-title">قسم تقنيات الأجهزة الطبية</h2>
                            <h3 class="print-subtitle">المعهد التقني في الكوت</h3>
                            <h4 class="print-title">بيان نتائج الطالب</h4>
                        </div>
                        
                        <div class="student-info mb-4">
                            <div class="info-item">
                                <span class="info-label">رقم السجل:</span>
                                <span class="info-value">${currentStudentRowNumber}</span>
                            </div>
                        </div>
                        
                        <table class="print-table">
                            <thead>
                                <tr>
                                    <th>المادة</th>
                                    <th>الدرجة</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${tableRows}
                            </tbody>
                        </table>
                        
                        <div class="signature-section">
                            <div class="signature-line"></div>
                            <div class="signature-label">التوقيع: .................................</div>
                            <div class="signature-label">رئيس القسم</div>
                        </div>
                        
                        <div class="print-footer">
                            <p>هذا البيان صادر من نظام نتائج الطلاب الجامعي © ${new Date().getFullYear()}</p>
                            <p>تاريخ الإصدار: ${new Date().toLocaleDateString('ar-EG')}</p>
                        </div>
                    </div>
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
        }
        
        // تحميل الإحصائيات من localStorage
        function loadStatistics() {
            const savedStats = localStorage.getItem('systemStats');
            if (savedStats) {
                systemStats = JSON.parse(savedStats);
            }
        }
        
        // حفظ الإحصائيات في localStorage
        function saveStatistics() {
            localStorage.setItem('systemStats', JSON.stringify(systemStats));
        }
        
        // تحديث عرض الإحصائيات
        function updateStatisticsDisplay() {
            document.getElementById('totalStudentsStat').textContent = systemStats.totalStudents.toLocaleString();
            document.getElementById('totalSearchesStat').textContent = systemStats.totalSearches.toLocaleString();
            document.getElementById('totalFilesStat').textContent = systemStats.totalFiles.toLocaleString();
            document.getElementById('successSearchesStat').textContent = systemStats.successSearches.toLocaleString();
        }
        
        // رسم الرسم البياني للإحصائيات
        function renderStatsChart() {
            const ctx = document.getElementById('statsChart').getContext('2d');
            
            // تدمير المخطط السابق إن وجد
            if (window.statsChartInstance) {
                window.statsChartInstance.destroy();
            }
            
            window.statsChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['الطلاب المسجلين', 'عمليات البحث', 'الملفات المرفوعة', 'النتائج المستخرجة'],
                    datasets: [{
                        label: 'إحصائيات النظام',
                        data: [
                            systemStats.totalStudents,
                            systemStats.totalSearches,
                            systemStats.totalFiles,
                            systemStats.successSearches
                        ],
                        backgroundColor: [
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(153, 102, 255, 0.7)',
                            'rgba(255, 159, 64, 0.7)'
                        ],
                        borderColor: [
                            'rgba(54, 162, 235, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                font: {
                                    size: 14,
                                    family: "'Cairo', sans-serif"
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 14,
                                    family: "'Cairo', sans-serif"
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    size: 16,
                                    family: "'Cairo', sans-serif"
                                }
                            }
                        },
                        tooltip: {
                            bodyFont: {
                                size: 14,
                                family: "'Cairo', sans-serif"
                            },
                            titleFont: {
                                size: 16,
                                family: "'Cairo', sans-serif"
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>